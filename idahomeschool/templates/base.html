
{% load static i18n %}
    {% load render_bundle from webpack_loader %}

  <!DOCTYPE html>
{% get_current_language as LANGUAGE_CODE %}
<html lang="{{ LANGUAGE_CODE }}">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <title>
      {% block title %}
      idahomeschool
    {% endblock title %}
  </title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description"
        content="A simple application for homeschooling parents" />
  <meta name="author"
        content="Taylor Daugherty" />
  <meta name="csrf-token" content="{{ csrf_token }}" />
  <link rel="icon" href="{% static 'images/favicons/favicon.ico' %}" />
  {% block css %}
<!-- Your stuff: Third-party CSS libraries go here -->
<!-- This file stores project-specific CSS -->


{% render_bundle 'project' 'css' %}


{% endblock css %}
<!-- Le javascript
    ================================================== -->
{# Placed at the top of the document so pages load faster with defer #}
{% block javascript %}


<!-- Vendor dependencies bundled as one file -->
{% render_bundle 'vendors' 'js' attrs='defer' %}

<!-- place project specific Javascript in this file -->
<!-- Note: HTMX is bundled in project.js via npm -->


{% render_bundle 'project' 'js' attrs='defer' %}

<!-- HTMX CSRF Configuration -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Configure HTMX to include CSRF token in all requests
    document.body.addEventListener('htmx:configRequest', function(event) {
      const csrfToken = document.querySelector('meta[name="csrf-token"]')?.content;
      if (csrfToken) {
        event.detail.headers['X-CSRFToken'] = csrfToken;
      }
    });
  });
</script>


{% endblock javascript %}
<!-- Bootstrap Icons -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>
<body class="{% block bodyclass %}{% endblock bodyclass %}">
  {% if request.user.is_authenticated %}
  <!-- Mobile header bar -->
  <div class="mobile-header">
    <button id="sidebarMenuToggle" type="button">
      <i class="bi bi-list"></i>
    </button>
    <div class="mobile-header-title">OpenHomeSchool</div>
  </div>

  <div class="d-flex" id="wrapper">
    <!-- Sidebar -->
    <div class="bg-light border-end" id="sidebar-wrapper">
      <!-- Close button for mobile -->
      <button id="sidebarClose" type="button">
        <i class="bi bi-x-lg"></i>
      </button>

      <div class="sidebar-heading border-bottom bg-primary text-white p-3">
        <h5 class="mb-0">OpenHomeSchool</h5>
      </div>
      <div class="list-group list-group-flush">
        <!-- Dashboard -->
        <a href="{% url 'academics:dashboard' %}"
           class="list-group-item list-group-item-action bg-light {% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}">
          <span><i class="bi bi-speedometer2 me-2"></i><span class="nav-text">Dashboard</span></span>
        </a>

        <!-- School Management Section -->
        <a href="#schoolSubmenu"
           class="list-group-item list-group-item-action bg-light sidebar-section-toggle collapsed"
           data-bs-toggle="collapse"
           aria-expanded="{% if 'schoolyear' in request.resolver_match.url_name or 'gradelevel' in request.resolver_match.url_name or 'student' in request.resolver_match.url_name or 'course' in request.resolver_match.url_name %}true{% else %}false{% endif %}">
          <span><i class="bi bi-building me-2"></i><span class="nav-text">Management</span></span>
          <i class="bi bi-chevron-down"></i>
        </a>
        <div class="collapse {% if 'schoolyear' in request.resolver_match.url_name or 'gradelevel' in request.resolver_match.url_name or 'student' in request.resolver_match.url_name or 'course' in request.resolver_match.url_name %}show{% endif %}"
             id="schoolSubmenu">
          <a href="{% url 'academics:schoolyear_list' %}"
             class="list-group-item list-group-item-action bg-light {% if 'schoolyear' in request.resolver_match.url_name %}active{% endif %}">
            <span><i class="bi bi-calendar-range me-2"></i><span class="nav-text">School Years</span></span>
          </a>
          <a href="{% url 'academics:gradelevel_list' %}"
             class="list-group-item list-group-item-action bg-light {% if 'gradelevel' in request.resolver_match.url_name %}active{% endif %}">
            <span><i class="bi bi-award me-2"></i><span class="nav-text">Grade Levels</span></span>
          </a>
          <a href="{% url 'academics:student_list' %}"
             class="list-group-item list-group-item-action bg-light {% if 'student' in request.resolver_match.url_name and 'grade' not in request.resolver_match.url_name %}active{% endif %}">
            <span><i class="bi bi-people me-2"></i><span class="nav-text">Students</span></span>
          </a>
          <a href="{% url 'academics:course_list' %}"
             class="list-group-item list-group-item-action bg-light {% if 'course' in request.resolver_match.url_name and 'template' not in request.resolver_match.url_name and 'enrollment' not in request.resolver_match.url_name %}active{% endif %}">
            <span><i class="bi bi-book me-2"></i><span class="nav-text">Courses</span></span>
          </a>
          <a href="{% url 'academics:coursetemplate_list' %}"
             class="list-group-item list-group-item-action bg-light {% if 'coursetemplate' in request.resolver_match.url_name %}active{% endif %}">
            <span><i class="bi bi-file-earmark-text me-2"></i><span class="nav-text">Course Templates</span></span>
          </a>
          <a href="{% url 'academics:courseenrollment_list' %}"
             class="list-group-item list-group-item-action bg-light {% if 'courseenrollment' in request.resolver_match.url_name %}active{% endif %}">
            <span><i class="bi bi-journal-check me-2"></i><span class="nav-text">Enrollments</span></span>
          </a>
        </div>

        <!-- Attendance Section -->
        <a href="#attendanceSubmenu"
           class="list-group-item list-group-item-action bg-light sidebar-section-toggle collapsed"
           data-bs-toggle="collapse"
           aria-expanded="{% if 'attendance' in request.resolver_match.url_name or 'dailylog' in request.resolver_match.url_name %}true{% else %}false{% endif %}">
          <span><i class="bi bi-calendar-check me-2"></i><span class="nav-text">Attendance</span></span>
          <i class="bi bi-chevron-down"></i>
        </a>
        <div class="collapse {% if 'attendance' in request.resolver_match.url_name or 'dailylog' in request.resolver_match.url_name %}show{% endif %}"
             id="attendanceSubmenu">
          <a href="{% url 'academics:dailylog_entry' %}"
             class="list-group-item list-group-item-action bg-light {% if 'dailylog_entry' in request.resolver_match.url_name %}active{% endif %}">
            <span><i class="bi bi-pencil-square me-2"></i><span class="nav-text">Daily Log Entry</span></span>
          </a>
          <a href="{% url 'academics:attendance_calendar' %}"
             class="list-group-item list-group-item-action bg-light {% if 'attendance_calendar' in request.resolver_match.url_name %}active{% endif %}">
            <span><i class="bi bi-calendar3 me-2"></i><span class="nav-text">Calendar View</span></span>
          </a>
          <a href="{% url 'academics:attendance_report' %}"
             class="list-group-item list-group-item-action bg-light {% if 'attendance_report' in request.resolver_match.url_name %}active{% endif %}">
            <span><i class="bi bi-file-earmark-text me-2"></i><span class="nav-text">Reports</span></span>
          </a>
          <a href="{% url 'academics:dailylog_list' %}"
             class="list-group-item list-group-item-action bg-light {% if 'dailylog_list' in request.resolver_match.url_name or 'dailylog_detail' in request.resolver_match.url_name %}active{% endif %}">
            <span><i class="bi bi-list-ul me-2"></i><span class="nav-text">All Logs</span></span>
          </a>
        </div>

        <!-- Resource Library Section -->
        <a href="#librarySubmenu"
           class="list-group-item list-group-item-action bg-light sidebar-section-toggle collapsed"
           data-bs-toggle="collapse"
           aria-expanded="{% if 'resource' in request.resolver_match.url_name or 'library' in request.resolver_match.url_name or 'tag' in request.resolver_match.url_name or 'color_palette' in request.resolver_match.url_name or 'readinglist' in request.resolver_match.url_name or 'reading_list' in request.resolver_match.url_name %}true{% else %}false{% endif %}">
          <span><i class="bi bi-collection me-2"></i><span class="nav-text">Resource Library</span></span>
          <i class="bi bi-chevron-down"></i>
        </a>
        <div class="collapse {% if 'resource' in request.resolver_match.url_name or 'library' in request.resolver_match.url_name or 'tag' in request.resolver_match.url_name or 'color_palette' in request.resolver_match.url_name or 'readinglist' in request.resolver_match.url_name or 'reading_list' in request.resolver_match.url_name %}show{% endif %}"
             id="librarySubmenu">
          <a href="{% url 'academics:resource_list' %}"
             class="list-group-item list-group-item-action bg-light {% if 'resource' in request.resolver_match.url_name or 'library' in request.resolver_match.url_name %}active{% endif %}">
            <span><i class="bi bi-book-half me-2"></i><span class="nav-text">Resources</span></span>
          </a>
          <a href="{% url 'academics:reading_list' %}"
             class="list-group-item list-group-item-action bg-light {% if 'readinglist' in request.resolver_match.url_name or 'reading_list' in request.resolver_match.url_name %}active{% endif %}">
            <span><i class="bi bi-book me-2"></i><span class="nav-text">Reading List</span></span>
          </a>
          <a href="{% url 'academics:tag_list' %}"
             class="list-group-item list-group-item-action bg-light {% if 'tag' in request.resolver_match.url_name and 'color_palette' not in request.resolver_match.url_name and 'book_tag' not in request.resolver_match.url_name %}active{% endif %}">
            <span><i class="bi bi-tags me-2"></i><span class="nav-text">Tags</span></span>
          </a>
          <a href="{% url 'academics:color_palette_list' %}"
             class="list-group-item list-group-item-action bg-light {% if 'color_palette' in request.resolver_match.url_name %}active{% endif %}">
            <span><i class="bi bi-palette me-2"></i><span class="nav-text">Color Palette</span></span>
          </a>
        </div>

        <!-- User Settings Section -->
        <a href="#userSubmenu"
           class="list-group-item list-group-item-action bg-light sidebar-section-toggle collapsed"
           data-bs-toggle="collapse"
           aria-expanded="false">
          <span><i class="bi bi-person-circle me-2"></i><span class="nav-text">{{ request.user.username }}</span></span>
          <i class="bi bi-chevron-down"></i>
        </a>
        <div class="collapse" id="userSubmenu">
          <a href="{% url 'users:detail' request.user.username %}"
             class="list-group-item list-group-item-action bg-light">
            <span><i class="bi bi-person me-2"></i><span class="nav-text">{% translate "My Profile" %}</span></span>
          </a>
          <a href="{% url 'account_logout' %}"
             class="list-group-item list-group-item-action bg-light">
            <span><i class="bi bi-box-arrow-right me-2"></i><span class="nav-text">{% translate "Sign Out" %}</span></span>
          </a>
        </div>
      </div>

      <!-- Sidebar toggle button (bottom) -->
      <div class="p-3 border-top sidebar-toggle-wrapper">
        <button class="btn btn-sm btn-outline-secondary w-100" id="sidebarToggle">
          <i class="bi bi-chevron-left"></i><span> Collapse</span>
        </button>
      </div>
    </div>
    <!-- /#sidebar-wrapper -->

    <!-- Page Content -->
    <div id="page-content-wrapper" class="w-100">
      <div class="container-fluid p-4">
        {% if messages %}
          {% for message in messages %}
            <div class="alert alert-dismissible {% if message.tags %}alert-{{ message.tags }}{% endif %}">
              {{ message }}
              <button type="button"
                      class="btn-close"
                      data-bs-dismiss="alert"
                      aria-label="Close"></button>
            </div>
          {% endfor %}
        {% endif %}
        {% block content %}
          <p>Use this document as a way to quick start any new project.</p>
        {% endblock content %}
      </div>
    </div>
    <!-- /#page-content-wrapper -->
  </div>
  {% else %}
  <!-- Not authenticated - show minimal layout -->
  <div class="container mt-5">
    {% if messages %}
      {% for message in messages %}
        <div class="alert alert-dismissible {% if message.tags %}alert-{{ message.tags }}{% endif %}">
          {{ message }}
          <button type="button"
                  class="btn-close"
                  data-bs-dismiss="alert"
                  aria-label="Close"></button>
        </div>
      {% endfor %}
    {% endif %}
    {% block unauthenticated_content %}{% endblock unauthenticated_content %}
  </div>
  {% endif %}
  <!-- /container -->
  {% block modal %}
  {% endblock modal %}
  {% block inline_javascript %}
    {% comment %}
    Script tags with only code, no src (defer by default). To run
    with a "defer" so that you run inline code:
    <script>
      window.addEventListener('DOMContentLoaded', () => {
        /* Run whatever you want */
      });
    </script>
    {% endcomment %}
  {% endblock inline_javascript %}
</body>
</html>
