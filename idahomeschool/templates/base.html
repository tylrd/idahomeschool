
{% load static i18n %}
    {% load render_bundle from webpack_loader %}

  <!DOCTYPE html>
{% get_current_language as LANGUAGE_CODE %}
<html lang="{{ LANGUAGE_CODE }}">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <title>
      {% block title %}
      idahomeschool
    {% endblock title %}
  </title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description"
        content="A simple application for homeschooling parents" />
  <meta name="author"
        content="Taylor Daugherty" />
  <meta name="csrf-token" content="{{ csrf_token }}" />
  <link rel="icon" href="{% static 'images/favicons/favicon.ico' %}" />
  {% block css %}
<!-- Your stuff: Third-party CSS libraries go here -->
<!-- This file stores project-specific CSS -->


{% render_bundle 'project' 'css' %}


{% endblock css %}
<!-- Le javascript
    ================================================== -->
{# Placed at the top of the document so pages load faster with defer #}
{% block javascript %}


<!-- Vendor dependencies bundled as one file -->
{% render_bundle 'vendors' 'js' attrs='defer' %}

<!-- place project specific Javascript in this file -->
<!-- Note: HTMX is bundled in project.js via npm -->


{% render_bundle 'project' 'js' attrs='defer' %}

<!-- HTMX CSRF Configuration -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Configure HTMX to include CSRF token in all requests
    document.body.addEventListener('htmx:configRequest', function(event) {
      const csrfToken = document.querySelector('meta[name="csrf-token"]')?.content;
      if (csrfToken) {
        event.detail.headers['X-CSRFToken'] = csrfToken;
      }
    });

    // Theme switcher initialization
    const theme = localStorage.getItem('theme') || 'light';
    if (theme === 'dark') {
      document.documentElement.classList.add('dark');
    }

    // Listen for theme toggle events
    document.addEventListener('basecoat:theme', function() {
      const isDark = document.documentElement.classList.contains('dark');
      if (isDark) {
        document.documentElement.classList.remove('dark');
        localStorage.setItem('theme', 'light');
      } else {
        document.documentElement.classList.add('dark');
        localStorage.setItem('theme', 'dark');
      }
    });
  });
</script>


{% endblock javascript %}
</head>
<body class="{% block bodyclass %}{% endblock bodyclass %}">
  {% if request.user.is_authenticated %}

  <!-- Basecoat Sidebar -->
  <aside class="sidebar" data-side="left" aria-hidden="false">
    <nav aria-label="Main navigation">

      <header>
        <a href="{% url 'academics:dashboard' %}" class="btn-ghost p-2 h-12 w-full justify-start">
          <div class="bg-sidebar-primary text-sidebar-primary-foreground flex aspect-square size-8 items-center justify-center rounded-lg">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M2 20h20M3 14h8v6H3zM13 10h8v10h-8z"></path>
            </svg>
          </div>
          <div class="grid flex-1 text-left text-sm leading-tight">
            <span class="truncate font-medium">OpenHomeSchool</span>
            <span class="truncate text-xs">{% translate "Homeschool Management" %}</span>
          </div>
        </a>
      </header>

      <section class="scrollbar">
        <!-- Quick Access -->
        <div role="group" aria-labelledby="group-label-quick">
          <h3 id="group-label-quick">Quick Access</h3>
          <ul>
            <li>
              <a href="{% url 'academics:dashboard' %}" {% if request.resolver_match.url_name == 'dashboard' %}class="active" aria-current="page"{% endif %}>
                <span>Dashboard</span>
              </a>
            </li>
            <li>
              <a href="{% url 'academics:dailylog_entry' %}" {% if 'dailylog_entry' in request.resolver_match.url_name %}class="active" aria-current="page"{% endif %}>
                <span>Daily Log Entry</span>
              </a>
            </li>
          </ul>
        </div>

        <!-- Management Section -->
        <div role="group" aria-labelledby="group-label-management">
          <h3 id="group-label-management">Management</h3>
          <ul>
            <li>
              <a href="{% url 'academics:schoolyear_list' %}" {% if 'schoolyear' in request.resolver_match.url_name %}class="active" aria-current="page"{% endif %}>
                <span>School Years</span>
              </a>
            </li>
            <li>
              <a href="{% url 'academics:gradelevel_list' %}" {% if 'gradelevel' in request.resolver_match.url_name %}class="active" aria-current="page"{% endif %}>
                <span>Grade Levels</span>
              </a>
            </li>
            <li>
              <a href="{% url 'academics:student_list' %}" {% if 'student' in request.resolver_match.url_name and 'grade' not in request.resolver_match.url_name %}class="active" aria-current="page"{% endif %}>
                <span>Students</span>
              </a>
            </li>
            <li>
              <a href="{% url 'academics:course_list' %}" {% if 'course' in request.resolver_match.url_name and 'template' not in request.resolver_match.url_name and 'enrollment' not in request.resolver_match.url_name %}class="active" aria-current="page"{% endif %}>
                <span>Courses</span>
              </a>
            </li>
            <li>
              <a href="{% url 'academics:coursetemplate_list' %}" {% if 'coursetemplate' in request.resolver_match.url_name %}class="active" aria-current="page"{% endif %}>
                <span>Course Templates</span>
              </a>
            </li>
            <li>
              <a href="{% url 'academics:courseenrollment_list' %}" {% if 'courseenrollment' in request.resolver_match.url_name %}class="active" aria-current="page"{% endif %}>
                <span>Enrollments</span>
              </a>
            </li>
          </ul>
        </div>

        <!-- Attendance Section -->
        <div role="group" aria-labelledby="group-label-attendance">
          <h3 id="group-label-attendance">Attendance</h3>
          <ul>
            <li>
              <a href="{% url 'academics:attendance_calendar' %}" {% if 'attendance_calendar' in request.resolver_match.url_name %}class="active" aria-current="page"{% endif %}>
                <span>Calendar View</span>
              </a>
            </li>
            <li>
              <a href="{% url 'academics:attendance_report' %}" {% if 'attendance_report' in request.resolver_match.url_name %}class="active" aria-current="page"{% endif %}>
                <span>Reports</span>
              </a>
            </li>
            <li>
              <a href="{% url 'academics:dailylog_list' %}" {% if 'dailylog_list' in request.resolver_match.url_name or 'dailylog_detail' in request.resolver_match.url_name %}class="active" aria-current="page"{% endif %}>
                <span>All Logs</span>
              </a>
            </li>
          </ul>
        </div>

        <!-- Resource Library Section -->
        <div role="group" aria-labelledby="group-label-library">
          <h3 id="group-label-library">Resource Library</h3>
          <ul>
            <li>
              <a href="{% url 'academics:resource_list' %}" {% if 'resource' in request.resolver_match.url_name or 'library' in request.resolver_match.url_name %}class="active" aria-current="page"{% endif %}>
                <span>Resources</span>
              </a>
            </li>
            <li>
              <a href="{% url 'academics:reading_list' %}" {% if 'readinglist' in request.resolver_match.url_name or 'reading_list' in request.resolver_match.url_name %}class="active" aria-current="page"{% endif %}>
                <span>Reading List</span>
              </a>
            </li>
            <li>
              <a href="{% url 'academics:tag_list' %}" {% if 'tag' in request.resolver_match.url_name and 'color_palette' not in request.resolver_match.url_name and 'book_tag' not in request.resolver_match.url_name %}class="active" aria-current="page"{% endif %}>
                <span>Tags</span>
              </a>
            </li>
            <li>
              <a href="{% url 'academics:color_palette_list' %}" {% if 'color_palette' in request.resolver_match.url_name %}class="active" aria-current="page"{% endif %}>
                <span>Color Palette</span>
              </a>
            </li>
          </ul>
        </div>
      </section>

    </nav>
  </aside>

  <!-- Main Content -->
  <main>
    <!-- Header bar with sidebar toggle -->
    <div class="flex h-14 w-full items-center gap-2 px-4 border-b bg-white">
      <button type="button" onclick="document.dispatchEvent(new CustomEvent('basecoat:sidebar'))" aria-label="Toggle sidebar" data-tooltip="Toggle sidebar" data-side="bottom" data-align="start" class="btn-sm-icon-ghost size-7 -ml-1.5">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect width="18" height="18" x="3" y="3" rx="2"></rect>
          <path d="M9 3v18"></path>
        </svg>
      </button>

      <div class="ml-auto flex items-center gap-2">
        <button type="button" aria-label="Toggle dark mode" data-tooltip="Toggle dark mode" data-side="bottom" onclick="document.dispatchEvent(new CustomEvent('basecoat:theme'))" class="btn-icon-outline size-8">
          <span class="hidden dark:block">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="4"></circle>
              <path d="M12 2v2"></path>
              <path d="M12 20v2"></path>
              <path d="m4.93 4.93 1.41 1.41"></path>
              <path d="m17.66 17.66 1.41 1.41"></path>
              <path d="M2 12h2"></path>
              <path d="M20 12h2"></path>
              <path d="m6.34 17.66-1.41 1.41"></path>
              <path d="m19.07 4.93-1.41 1.41"></path>
            </svg>
          </span>
          <span class="block dark:hidden">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"></path>
            </svg>
          </span>
        </button>

        <div class="dropdown-menu !min-w-0 w-fit">
          <button type="button" id="user-menu-trigger" aria-haspopup="menu" aria-controls="user-menu" aria-expanded="false" class="btn-icon-ghost size-8">
            <div class="bg-accent text-accent-foreground flex items-center justify-center rounded-full size-8">
              <span class="text-sm font-medium">{{ request.user.username|slice:":2"|upper }}</span>
            </div>
          </button>
          <div id="user-menu-popover" data-popover aria-hidden="true" data-side="bottom" data-align="end" class="min-w-56">
            <div role="menu" id="user-menu" aria-labelledby="user-menu-trigger">
              <div role="menuitem">
                <a href="{% url 'users:detail' request.user.username %}" class="flex items-center gap-2">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                  </svg>
                  Profile
                </a>
              </div>
              <div role="menuitem">
                <a href="{% url 'users:update' %}" class="flex items-center gap-2">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                  </svg>
                  Settings
                </a>
              </div>
              <hr role="separator" />
              <div role="menuitem">
                <a href="{% url 'account_logout' %}" class="flex items-center gap-2">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                    <polyline points="16 17 21 12 16 7"></polyline>
                    <line x1="21" y1="12" x2="9" y2="12"></line>
                  </svg>
                  Log out
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="w-full p-4 md:p-8">
        {% if messages %}
          {% for message in messages %}
            <div class="rounded-lg p-4 mb-4 border {% if message.tags == 'success' %}bg-green-50 text-green-800 border-green-200{% elif message.tags == 'error' or message.tags == 'danger' %}bg-red-50 text-red-800 border-red-200{% elif message.tags == 'warning' %}bg-yellow-50 text-yellow-800 border-yellow-200{% else %}bg-blue-50 text-blue-800 border-blue-200{% endif %}">
              <div class="flex justify-between items-start">
                <p>{{ message }}</p>
                <button type="button" onclick="this.closest('div').remove()" class="text-current opacity-50 hover:opacity-100">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
            </div>
          {% endfor %}
        {% endif %}
      {% block content %}
        <p>Use this document as a way to quick start any new project.</p>
      {% endblock content %}
    </div>
  </main>
  {% else %}
  <!-- Not authenticated - show minimal layout -->
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-8">
    {% if messages %}
      {% for message in messages %}
        <div class="rounded-lg p-4 mb-4 border {% if message.tags == 'success' %}bg-green-50 text-green-800 border-green-200{% elif message.tags == 'error' or message.tags == 'danger' %}bg-red-50 text-red-800 border-red-200{% elif message.tags == 'warning' %}bg-yellow-50 text-yellow-800 border-yellow-200{% else %}bg-blue-50 text-blue-800 border-blue-200{% endif %}">
          <div class="flex justify-between items-start">
            <p>{{ message }}</p>
            <button type="button" onclick="this.closest('div').remove()" class="text-current opacity-50 hover:opacity-100">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
        </div>
      {% endfor %}
    {% endif %}
    {% block unauthenticated_content %}{% endblock unauthenticated_content %}
  </div>
  {% endif %}
  <!-- /container -->
  {% block modal %}
  {% endblock modal %}
  {% block inline_javascript %}
    {% comment %}
    Script tags with only code, no src (defer by default). To run
    with a "defer" so that you run inline code:
    <script>
      window.addEventListener('DOMContentLoaded', () => {
        /* Run whatever you want */
      });
    </script>
    {% endcomment %}
  {% endblock inline_javascript %}
</body>
</html>
