{% extends "academics/base.html" %}
{% load static %}

{% block title %}Courses{% endblock %}

{% block academics_content %}
<div class="flex justify-between items-center mb-6">
  <h1 class="text-3xl font-bold tracking-tight">Courses</h1>
  <a href="{% url 'academics:course_create' %}" class="btn-outline">
    <i data-lucide="plus-circle"></i> Add Course
  </a>
</div>

{% if grouped_courses or unassigned_courses %}
<div class="space-y-8">
  <!-- Grouped by Grade Level -->
  {% for grade_level, courses_list in grouped_courses %}
  <div x-data="{ open: true }">
    <!-- Section Header -->
    <div class="flex items-center justify-between pb-2 border-b">
      <button @click="open = !open" class="flex items-center gap-2 text-left group">
        <i data-lucide="chevron-down"
           class="size-5 text-muted-foreground transition-transform"
           :class="{ '-rotate-90': !open }"></i>
        <h2 class="text-xl font-semibold tracking-tight">{{ grade_level.name }}</h2>
        <span class="badge badge-sm ml-2">{{ courses_list|length }}</span>
      </button>
    </div>

    <!-- Course Table -->
    <div x-show="open" x-collapse>
      <div class="relative w-full overflow-x-auto">
        <table class="table">
          <tbody>
            {% for course in courses_list %}
            <tr>
              <td>
                <a href="{% url 'academics:course_detail' course.pk %}" class="link font-medium">{{ course.name }}</a>
              </td>
              <td class="text-muted-foreground">
                {% if course.course_template %}
                  <a href="{% url 'academics:coursetemplate_detail' course.course_template.pk %}" class="link text-sm">{{ course.course_template.name }}</a>
                {% else %}
                  <span class="text-muted-foreground/50">-</span>
                {% endif %}
              </td>
              <td>
                <div class="flex gap-1 justify-end">
                  <a href="{% url 'academics:course_update' course.pk %}"
                     class="btn-icon-outline size-8">
                    <i data-lucide="pencil"></i>
                  </a>
                  <a href="{% url 'academics:course_delete' course.pk %}"
                     class="btn-icon-outline size-8 text-destructive hover:bg-destructive/10">
                    <i data-lucide="trash-2"></i>
                  </a>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
  {% endfor %}

  <!-- Unassigned Courses (no grade level) -->
  {% if unassigned_courses %}
  <div x-data="{ open: true }">
    <!-- Section Header -->
    <div class="flex items-center justify-between pb-2 border-b">
      <button @click="open = !open" class="flex items-center gap-2 text-left group">
        <i data-lucide="chevron-down"
           class="size-5 text-muted-foreground transition-transform"
           :class="{ '-rotate-90': !open }"></i>
        <h2 class="text-xl font-semibold tracking-tight">Unassigned Grade Level</h2>
        <span class="badge badge-sm ml-2">{{ unassigned_courses|length }}</span>
      </button>
    </div>

    <!-- Course Table -->
    <div x-show="open" x-collapse>
      <div class="relative w-full overflow-x-auto">
        <table class="table">
          <tbody>
            {% for course in unassigned_courses %}
            <tr>
              <td>
                <a href="{% url 'academics:course_detail' course.pk %}" class="link font-medium">{{ course.name }}</a>
              </td>
              <td class="text-muted-foreground">
                {% if course.course_template %}
                  <a href="{% url 'academics:coursetemplate_detail' course.course_template.pk %}" class="link text-sm">{{ course.course_template.name }}</a>
                {% else %}
                  <span class="text-muted-foreground/50">-</span>
                {% endif %}
              </td>
              <td>
                <div class="flex gap-1 justify-end">
                  <a href="{% url 'academics:course_update' course.pk %}"
                     class="btn-icon-outline size-8">
                    <i data-lucide="pencil"></i>
                  </a>
                  <a href="{% url 'academics:course_delete' course.pk %}"
                     class="btn-icon-outline size-8 text-destructive hover:bg-destructive/10">
                    <i data-lucide="trash-2"></i>
                  </a>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
  {% endif %}
</div>

{% else %}
<div class="p-12 text-center">
  <div class="mx-auto flex max-w-md flex-col items-center gap-2">
    <div class="flex size-12 items-center justify-center rounded-full bg-muted">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-muted-foreground">
        <path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"/>
      </svg>
    </div>
    <h2 class="text-xl font-semibold">No courses found</h2>
    {% if search_query %}
      <p class="text-sm text-muted-foreground mb-2">No courses match your search criteria.</p>
      <a href="{% url 'academics:course_list' %}" class="btn-outline">Clear Search</a>
    {% else %}
      <p class="text-sm text-muted-foreground mb-2">Get started by adding your first course to track student learning.</p>
      <a href="{% url 'academics:course_create' %}" class="btn">
        <i data-lucide="plus-circle"></i> Add Course
      </a>
    {% endif %}
  </div>
</div>
{% endif %}
{% endblock academics_content %}
