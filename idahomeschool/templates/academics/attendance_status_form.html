{% extends "academics/base.html" %}
{% load crispy_forms_tags %}

{% block title %}{% if form.instance.pk %}Edit{% else %}Add{% endif %} Attendance Status{% endblock %}

{% block academics_content %}
<div class="flex justify-between items-center mb-4">
  <h1>{% if form.instance.pk %}Edit{% else %}Add{% endif %} Attendance Status</h1>
</div>

<div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
  <div class="lg:col-span-2">
    <div class="card">
      <section>
        <form method="post">
          {% csrf_token %}
          {{ form|crispy }}

          <div class="flex gap-2 mt-4">
            <button type="submit" class="btn-primary">
              <i class="bi bi-check-circle"></i> Save Status
            </button>
            <a href="{% url 'academics:attendance_status_list' %}" class="btn-secondary">
              <i class="bi bi-x-circle"></i> Cancel
            </a>
          </div>
        </form>
      </section>
    </div>
  </div>

  <div>
    <div class="card">
      <section>
        <h5 class="font-semibold mb-2">Color Picker Tips</h5>
        <p class="text-sm text-muted-foreground">Click on the color field to use your browser's color picker, or manually enter a hex color code.</p>

        {% if palette_colors %}
        <h6 class="mt-3 font-semibold text-sm">Colors from Active Palette:</h6>
        <div class="flex flex-wrap gap-2">
          {% for color in palette_colors %}
          <button type="button"
                  class="btn-sm"
                  style="background-color: {{ color.color }}; width: 40px; height: 40px; padding: 0; border: 2px solid #dee2e6;"
                  onclick="document.getElementById('id_color').value = '{{ color.color }}'; document.getElementById('id_color').dispatchEvent(new Event('change'));"
                  title="{{ color.name|default:color.color }}">
          </button>
          {% endfor %}
        </div>
        <p class="text-sm text-muted-foreground mt-2">Click a color to use it for this status.</p>
        {% endif %}

        <h6 class="mt-4 font-semibold text-sm">Field Descriptions:</h6>
        <dl class="text-sm">
          <dt class="font-semibold">Code</dt>
          <dd class="ml-4 mb-2">Internal identifier (e.g., PRESENT, SICK). Use UPPERCASE_WITH_UNDERSCORES.</dd>

          <dt class="font-semibold">Label</dt>
          <dd class="ml-4 mb-2">Display name shown to users (e.g., "Present", "Sick Leave").</dd>

          <dt class="font-semibold">Abbreviation</dt>
          <dd class="ml-4 mb-2">1-3 letter code shown on calendar (e.g., "P", "S"). Keep it short!</dd>

          <dt class="font-semibold">Color</dt>
          <dd class="ml-4 mb-2">Background color for the status badge. Choose from your palette or enter a custom hex code.</dd>

          <dt class="font-semibold">Instructional</dt>
          <dd class="ml-4 mb-2">Check if this status counts as an instructional day in reports.</dd>

          <dt class="font-semibold">Default</dt>
          <dd class="ml-4 mb-2">Check to make this the default status for new attendance entries. Only one status can be default.</dd>
        </dl>
      </section>
    </div>
  </div>
</div>

{% endblock academics_content %}
