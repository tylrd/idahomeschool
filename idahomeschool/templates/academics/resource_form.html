{% extends "academics/base.html" %}
{% load crispy_forms_tags %}
{% load static %}

{% block title %}{% if form.instance.pk %}Edit{% else %}Add{% endif %} Resource{% endblock %}

{% block academics_content %}
<div class="card">
  <header>
    <h2>{% if form.instance.pk %}Edit{% else %}Add{% endif %} Resource</h2>
  </header>
  <section>
    <form method="post" enctype="multipart/form-data">
      {% csrf_token %}

      {# Title field #}
      <div class="grid gap-2">
        <label for="id_title">Title *</label>
        {{ form.title }}
        {% if form.title.errors %}
          <p class="text-destructive text-sm">{{ form.title.errors.0 }}</p>
        {% endif %}
      </div>

      {# Author and Publisher #}
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
        <div class="grid gap-2">
          <label for="id_author">Author</label>
          {{ form.author }}
          {% if form.author.errors %}
            <p class="text-destructive text-sm">{{ form.author.errors.0 }}</p>
          {% endif %}
        </div>
        <div class="grid gap-2">
          <label for="id_publisher">Publisher</label>
          {{ form.publisher }}
          {% if form.publisher.errors %}
            <p class="text-destructive text-sm">{{ form.publisher.errors.0 }}</p>
          {% endif %}
        </div>
      </div>

      {# ISBN and Resource Type #}
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
        <div class="grid gap-2">
          <label for="id_isbn">ISBN</label>
          {{ form.isbn }}
          {% if form.isbn.errors %}
            <p class="text-destructive text-sm">{{ form.isbn.errors.0 }}</p>
          {% endif %}
        </div>
        <div class="grid gap-2">
          <label for="id_resource_type">Resource Type</label>
          {{ form.resource_type }}
          {% if form.resource_type.errors %}
            <p class="text-destructive text-sm">{{ form.resource_type.errors.0 }}</p>
          {% endif %}
        </div>
      </div>

      {# Description #}
      <div class="grid gap-2 mt-4">
        <label for="id_description">Description</label>
        {{ form.description }}
        {% if form.description.errors %}
          <p class="text-destructive text-sm">{{ form.description.errors.0 }}</p>
        {% endif %}
      </div>

      {# Image field #}
      <div class="grid gap-2 mt-4">
        <label for="id_image">Cover Image / Thumbnail</label>
        {% if form.instance.image %}
          <div class="mb-2">
            <img src="{{ form.instance.image.url }}" alt="Current image" class="img-thumbnail" style="max-height: 150px;">
            <p class="text-muted-foreground text-sm">Current image (select a new file to replace)</p>
          </div>
        {% endif %}
        {{ form.image }}
        {% if form.image.errors %}
          <p class="text-destructive text-sm">{{ form.image.errors.0 }}</p>
        {% endif %}
        <p class="text-muted-foreground text-sm">Optional cover image or thumbnail for this resource</p>
      </div>

      {# Tags field - use custom tag selector component #}
      {# Note: tag selector creates its own hidden input with name="tags_data" #}
      <div class="grid gap-2 mt-4">
        <label>Tags</label>
        {% if form.instance.pk %}
          {% include "academics/partials/tag_selector.html" with field_name="tags" selected_tags=form.instance.tags.all selected_tags_json=form.initial.tags_data %}
        {% else %}
          {% include "academics/partials/tag_selector.html" with field_name="tags" %}
        {% endif %}
      </div>

      <div class="flex gap-2 mt-6">
        <button type="submit" class="btn-primary">Save Resource</button>
        <a href="{% url 'academics:resource_list' %}" class="btn-secondary">Cancel</a>
      </div>
    </form>
  </section>
</div>
{% endblock academics_content %}
