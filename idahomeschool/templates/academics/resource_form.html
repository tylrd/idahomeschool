{% extends "academics/base.html" %}
{% load crispy_forms_tags %}
{% load static %}

{% block title %}{% if form.instance.pk %}Edit{% else %}Add{% endif %} Resource{% endblock %}

{% block academics_content %}
<div class="card">
  <div class="card-header">
    <h3 class="mb-0">{% if form.instance.pk %}Edit{% else %}Add{% endif %} Resource</h3>
  </div>
  <div class="card-body">
    <form method="post">
      {% csrf_token %}

      {# Title field #}
      <div class="mb-3">
        <label for="id_title" class="form-label">Title *</label>
        {{ form.title }}
        {% if form.title.errors %}
          <div class="invalid-feedback d-block">{{ form.title.errors.0 }}</div>
        {% endif %}
      </div>

      {# Author and Publisher #}
      <div class="row">
        <div class="col-md-6 mb-3">
          <label for="id_author" class="form-label">Author</label>
          {{ form.author }}
          {% if form.author.errors %}
            <div class="invalid-feedback d-block">{{ form.author.errors.0 }}</div>
          {% endif %}
        </div>
        <div class="col-md-6 mb-3">
          <label for="id_publisher" class="form-label">Publisher</label>
          {{ form.publisher }}
          {% if form.publisher.errors %}
            <div class="invalid-feedback d-block">{{ form.publisher.errors.0 }}</div>
          {% endif %}
        </div>
      </div>

      {# ISBN and Resource Type #}
      <div class="row">
        <div class="col-md-6 mb-3">
          <label for="id_isbn" class="form-label">ISBN</label>
          {{ form.isbn }}
          {% if form.isbn.errors %}
            <div class="invalid-feedback d-block">{{ form.isbn.errors.0 }}</div>
          {% endif %}
        </div>
        <div class="col-md-6 mb-3">
          <label for="id_resource_type" class="form-label">Resource Type</label>
          {{ form.resource_type }}
          {% if form.resource_type.errors %}
            <div class="invalid-feedback d-block">{{ form.resource_type.errors.0 }}</div>
          {% endif %}
        </div>
      </div>

      {# Description #}
      <div class="mb-3">
        <label for="id_description" class="form-label">Description</label>
        {{ form.description }}
        {% if form.description.errors %}
          <div class="invalid-feedback d-block">{{ form.description.errors.0 }}</div>
        {% endif %}
      </div>

      {# Tags field - use custom tag selector component #}
      {# Note: tag selector creates its own hidden input with name="tags_data" #}
      <div class="mb-3">
        <label class="form-label">Tags</label>
        {% if form.instance.pk %}
          {% include "academics/partials/tag_selector.html" with field_name="tags" selected_tags=form.instance.tags.all selected_tags_json=form.initial.tags_data %}
        {% else %}
          {% include "academics/partials/tag_selector.html" with field_name="tags" %}
        {% endif %}
      </div>

      <div class="d-flex gap-2">
        <button type="submit" class="btn btn-primary">Save Resource</button>
        <a href="{% url 'academics:resource_list' %}" class="btn btn-secondary">Cancel</a>
      </div>
    </form>
  </div>
</div>
{% endblock academics_content %}
