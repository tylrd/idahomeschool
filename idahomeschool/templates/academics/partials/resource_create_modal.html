{% load crispy_forms_tags %}
{% load static %}

<!-- Resource Creation Dialog Content -->
<div>
  <header>
    <h2 id="resource-create-dialog-title" class="text-lg font-semibold">Create New Resource</h2>
    <p id="resource-create-dialog-description" class="text-sm text-muted-foreground">Add a new curriculum resource to your library.</p>
  </header>

  <form
    hx-post="/academics/resources/create-modal/?field_name={{ field_name }}&selected_ids={{ selected_ids }}"
    hx-target="#resource-search-results-{{ field_name }}"
    hx-swap="innerHTML"
    hx-encoding="multipart/form-data"
    method="post"
    enctype="multipart/form-data"
    class="form"
  >
    <section class="space-y-4">
      {% csrf_token %}

      {# Title field #}
      <div class="grid gap-2">
        <label for="id_title" class="text-sm font-medium">Title *</label>
        <input type="text" class="{% if form.title.errors %}border-destructive{% endif %}" id="id_title" name="title" value="{{ form.title.value|default:'' }}" required>
        {% if form.title.errors %}
        <p class="text-destructive text-sm">{{ form.title.errors.0 }}</p>
        {% endif %}
      </div>

      {# Author and Publisher #}
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="grid gap-2">
          <label for="id_author" class="text-sm font-medium">Author</label>
          <input type="text" class="{% if form.author.errors %}border-destructive{% endif %}" id="id_author" name="author" value="{{ form.author.value|default:'' }}">
          {% if form.author.errors %}
          <p class="text-destructive text-sm">{{ form.author.errors.0 }}</p>
          {% endif %}
        </div>
        <div class="grid gap-2">
          <label for="id_publisher" class="text-sm font-medium">Publisher</label>
          <input type="text" class="{% if form.publisher.errors %}border-destructive{% endif %}" id="id_publisher" name="publisher" value="{{ form.publisher.value|default:'' }}">
          {% if form.publisher.errors %}
          <p class="text-destructive text-sm">{{ form.publisher.errors.0 }}</p>
          {% endif %}
        </div>
      </div>

      {# ISBN and Resource Type #}
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="grid gap-2">
          <label for="id_isbn" class="text-sm font-medium">ISBN</label>
          <input type="text" class="{% if form.isbn.errors %}border-destructive{% endif %}" id="id_isbn" name="isbn" value="{{ form.isbn.value|default:'' }}">
          {% if form.isbn.errors %}
          <p class="text-destructive text-sm">{{ form.isbn.errors.0 }}</p>
          {% endif %}
        </div>
        <div class="grid gap-2">
          <label for="id_resource_type" class="text-sm font-medium">Resource Type</label>
          <select class="{% if form.resource_type.errors %}border-destructive{% endif %}" id="id_resource_type" name="resource_type">
            <option value="BOOK" {% if form.resource_type.value == 'BOOK' %}selected{% endif %}>Book</option>
            <option value="WORKBOOK" {% if form.resource_type.value == 'WORKBOOK' %}selected{% endif %}>Workbook</option>
            <option value="ONLINE" {% if form.resource_type.value == 'ONLINE' %}selected{% endif %}>Online Course</option>
            <option value="VIDEO" {% if form.resource_type.value == 'VIDEO' %}selected{% endif %}>Video Course</option>
            <option value="SOFTWARE" {% if form.resource_type.value == 'SOFTWARE' %}selected{% endif %}>Software</option>
            <option value="OTHER" {% if form.resource_type.value == 'OTHER' %}selected{% endif %}>Other</option>
          </select>
          {% if form.resource_type.errors %}
          <p class="text-destructive text-sm">{{ form.resource_type.errors.0 }}</p>
          {% endif %}
        </div>
      </div>

      {# Description #}
      <div class="grid gap-2">
        <label for="id_description" class="text-sm font-medium">Description</label>
        <textarea class="{% if form.description.errors %}border-destructive{% endif %}" id="id_description" name="description" rows="3">{{ form.description.value|default:'' }}</textarea>
        {% if form.description.errors %}
        <p class="text-destructive text-sm">{{ form.description.errors.0 }}</p>
        {% endif %}
      </div>

      {# Image field #}
      <div class="grid gap-2">
        <label for="id_image" class="text-sm font-medium">Cover Image / Thumbnail</label>
        <input type="file" class="{% if form.image.errors %}border-destructive{% endif %}" id="id_image" name="image" accept="image/*">
        {% if form.image.errors %}
        <p class="text-destructive text-sm">{{ form.image.errors.0 }}</p>
        {% endif %}
        <p class="text-muted-foreground text-sm">Optional cover image or thumbnail for this resource</p>
      </div>

      {# Tags field - use custom tag selector component #}
      <div class="grid gap-2">
        <label class="text-sm font-medium">Tags</label>
        {% include "academics/partials/tag_selector.html" with field_name="tags" %}
      </div>

    </section>

    <footer>
      <button type="button" class="btn-outline" onclick="this.closest('dialog').close()">
        <i data-lucide="x"></i> Cancel
      </button>
      <button type="submit" class="btn">
        <i data-lucide="save"></i> Create Resource
      </button>
    </footer>
  </form>

  <button type="button" class="dialog-close" aria-label="Close dialog" onclick="this.closest('dialog').close()">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M18 6 6 18"/>
      <path d="m6 6 12 12"/>
    </svg>
  </button>
</div>
